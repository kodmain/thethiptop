FROM --platform=$BUILDPLATFORM alpine:edge AS builder

ARG BUILDPLATFORM
ARG TARGETPLATFORM
ARG TARGETOS
ARG TARGETARCH
ARG BINARY_VERSION

ENV BUILDPLATFORM=$BUILDPLATFORM
ENV TARGETPLATFORM=$TARGETPLATFORM
ENV TARGETOS=$TARGETOS
ENV TARGETARCH=$TARGETARCH
ENV BINARY_VERSION=$BINARY_VERSION

WORKDIR /project
ADD https://github.com/kodmain/thetiptop/releases/download/$BINARY_VERSION/thetiptop-linux-$TARGETARCH /project/service
RUN chmod +x /project/service

LABEL org.opencontainers.image.source="https://github.com/kodmain/thetiptop"
LABEL VERSION=$BINARY_VERSION
EXPOSE 80

ENTRYPOINT [ "/project/service" ]